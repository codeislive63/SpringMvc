<!DOCTYPE html>
<html lang="ru"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <title>Личный кабинет • Railway Booker</title>
    <link rel="stylesheet" th:href="@{/css/app.css}">
</head>
<body class="app-bg">

<header th:replace="~{fragments/topbar :: topbar}"></header>

<main class="page">
    <section class="welcome">
        <div class="section-title">
            <div class="eyebrow">Профиль</div>
            <h1 style="margin: 0;">Личный кабинет</h1>
        </div>
        <p>Здравствуйте, <b th:text="${user.fullName}">Имя</b>!</p>
        <p>Email: <span th:text="${user.email}">email</span></p>

        <div class="info-grid">
            <div class="info-tile">
                <div class="label">Сохранённые пассажиры</div>
                <span class="value">Храните документы и льготы для быстрого оформления</span>
            </div>
            <div class="info-tile">
                <div class="label">История поездок</div>
                <span class="value">Повторяйте маршруты и скачивайте билеты</span>
            </div>
            <div class="info-tile">
                <div class="label">Бонусы и скидки</div>
                <span class="value">Лояльность, промокоды, детские тарифы</span>
            </div>
            <div class="info-tile">
                <div class="label">Документы</div>
                <span class="value">Паспорт, ID-карта, детские свидетельства</span>
            </div>
        </div>
    </section>

    <section class="cards-grid">
        <!-- Сохранённые пассажиры -->
        <article class="card">
            <h2>Сохранённые пассажиры и документы</h2>
            <p class="muted">Добавьте часто используемые данные, чтобы оформлять билеты быстрее.</p>
            <div class="list-stripe">
                <div class="row-item">
                    <div>
                        <div class="title">Основной пассажир</div>
                        <div class="meta">Паспорт • Льгот нет</div>
                    </div>
                    <button class="btn ghost" type="button" disabled>Редактировать</button>
                </div>
                <div class="row-item">
                    <div>
                        <div class="title">Детский билет</div>
                        <div class="meta">Свидетельство о рождении • Детский тариф</div>
                    </div>
                    <button class="btn ghost" type="button" disabled>Редактировать</button>
                </div>
            </div>
        </article>

        <!-- Активные (неоплаченные) брони -->
        <article class="card">
            <h2>Активные брони</h2>
            <div th:if="${#lists.isEmpty(unpaidTickets)}">
                <p>Нет активных бронирований.</p>
            </div>
            <div th:each="t : ${unpaidTickets}">
                <h3 th:text="${t.trip.route.origin.name + ' — ' + t.trip.route.destination.name}">Маршрут</h3>
                <p th:text="'Отправление: ' + ${#temporals.format(t.trip.departureTime, 'dd.MM.yyyy HH:mm')}"></p>
                <p th:text="'Место: ' + ${t.seatNumber}"></p>
                <p th:text="'Цена: ' + ${#numbers.formatDecimal(t.price, 1, 'COMMA', 2, 'POINT')} + ' BYN'"></p>
                <p>Статус: <span th:text="${t.status.label}"></span></p>
                <div class="actions">
                    <form th:action="@{/booking/pay/{id}(id=${t.id})}" method="post">
                        <button class="btn primary" type="submit">Оплатить</button>
                    </form>
                    <form th:action="@{/tickets/{id}/refund(id=${t.id})}" method="post"
                          onsubmit="return confirm('Отменить бронь? Место станет доступно снова.')">
                        <button class="btn danger" type="submit">Отменить</button>
                    </form>
                </div>
                <hr>
            </div>
        </article>

        <!-- Оплаченные билеты -->
        <article class="card">
            <h2>Покупки</h2>
            <div th:if="${#lists.isEmpty(paidTickets)}">
                <p>Нет оплаченных билетов.</p>
            </div>
            <div th:each="t : ${paidTickets}">
                <h3 th:text="${t.trip.route.origin.name + ' — ' + t.trip.route.destination.name}">Маршрут</h3>
                <p th:text="'Отправление: ' + ${#temporals.format(t.trip.departureTime, 'dd.MM.yyyy HH:mm')}"></p>
                <p th:text="'Место: ' + ${t.seatNumber}"></p>
                <p th:text="'Цена: ' + ${#numbers.formatDecimal(t.price, 1, 'COMMA', 2, 'POINT')} + ' BYN'"></p>
                <p>Статус: <span th:text="${t.status.label}"></span></p>
                <!-- разрешаем возврат даже для оплаченных билетов -->
                <form th:action="@{/tickets/{id}/refund(id=${t.id})}" method="post"
                      onsubmit="return confirm('Вернуть билет? Средства будут возвращены.')">
                    <button class="btn danger" type="submit">Вернуть</button>
                </form>
                <hr>
            </div>
        </article>

        <!-- Отменённые/возвращённые -->
        <article class="card">
            <h2>Отменённые билеты</h2>
            <div th:if="${#lists.isEmpty(cancelledTickets)}">
                <p>Нет отменённых или возвращённых билетов.</p>
            </div>
            <div th:each="t : ${cancelledTickets}">
                <h3 th:text="${t.trip.route.origin.name + ' — ' + t.trip.route.destination.name}">Маршрут</h3>
                <p th:text="'Отправление: ' + ${#temporals.format(t.trip.departureTime, 'dd.MM.yyyy HH:mm')}"></p>
                <p th:text="'Место: ' + ${t.seatNumber}"></p>
                <p th:text="'Цена: ' + ${#numbers.formatDecimal(t.price, 1, 'COMMA', 2, 'POINT')} + ' BYN'"></p>
                <p>Статус: <span th:text="${t.status.label}"></span></p>
                <hr>
            </div>
        </article>

        <!-- Бонусы и лояльность -->
        <article class="card">
            <h2>Бонусы и скидки</h2>
            <div class="info-grid">
                <div class="info-tile">
                    <div class="label">Баланс бонусов</div>
                    <span class="value">0</span>
                </div>
                <div class="info-tile">
                    <div class="label">Уровень лояльности</div>
                    <span class="value">Базовый</span>
                </div>
                <div class="info-tile">
                    <div class="label">Персональные скидки</div>
                    <span class="value">Льготные и детские тарифы доступны</span>
                </div>
            </div>
            <div class="card-actions" style="margin-top: 12px;">
                <button class="btn ghost" type="button" disabled>Активировать промокод</button>
                <button class="btn ghost" type="button" disabled>Подключить программу</button>
            </div>
        </article>
    </section>
</main>
</body>
</html>
